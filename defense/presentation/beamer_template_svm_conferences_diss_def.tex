\documentclass[$if(fontsize)$$fontsize$,$endif$$if(lang)$$babel-lang$,$endif$$if(handout)$handout,$endif$$if(beamer)$,$endif$$for(classoption)$$classoption$$sep$,$endfor$]{$documentclass$}
$if(theme)$
\usetheme{$theme$}
$endif$
$if(colortheme)$
\usecolortheme{$colortheme$}
$endif$
$if(fonttheme)$
\usefonttheme{$fonttheme$}
$endif$
$if(mainfont)$
\usefonttheme{serif} % use mainfont rather than sansfont for slide text
$endif$
$if(innertheme)$
\useinnertheme{$innertheme$}
$endif$
$if(outertheme)$
\useoutertheme{$outertheme$}
$endif$
\setbeamertemplate{caption}[numbered]
\setbeamertemplate{caption label separator}{: }
\setbeamercolor{caption name}{fg=normal text.fg}
$if(fontfamily)$
\usepackage[$fontfamilyoptions$]{$fontfamily$}
$else$
\usepackage{lmodern}
$endif$
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[$if(fontenc)$$fontenc$$else$T1$endif$]{fontenc}
  \usepackage[utf8]{inputenc}
$if(euro)$
  \usepackage{eurosym}
$endif$
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
$if(mainfont)$
    \setmainfont[$mainfontoptions$]{$mainfont$}
$endif$
$if(sansfont)$
    \setsansfont[$sansfontoptions$]{$sansfont$}
$endif$
$if(monofont)$
    \setmonofont[Mapping=tex-ansi$if(monofontoptions)$,$monofontoptions$$endif$]{$monofont$}
$endif$
$if(mathfont)$
    \setmathfont(Digits,Latin,Greek)[$mathfontoptions$]{$mathfont$}
$endif$
$if(CJKmainfont)$
    \usepackage{xeCJK}
    \setCJKmainfont[$CJKoptions$]{$CJKmainfont$}
$endif$
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
$if(lang)$
\ifxetex
  \usepackage{polyglossia}
  \setmainlanguage[$polyglossia-lang.options$]{$polyglossia-lang.name$}
$for(polyglossia-otherlangs)$
  \setotherlanguage[$polyglossia-otherlangs.options$]{$polyglossia-otherlangs.name$}
$endfor$
\else
  \usepackage[shorthands=off,$babel-lang$]{babel}
\fi
$endif$
$if(natbib)$
\usepackage{natbib}
\bibliographystyle{$if(biblio-style)$$biblio-style$$else$plainnat$endif$}
$endif$
$if(biblatex)$
\usepackage{biblatex}
$for(bibliography)$
\addbibresource{$bibliography$}
$endfor$
$endif$
$if(listings)$
\usepackage{listings}
$endif$
$if(lhs)$
\lstnewenvironment{code}{\lstset{language=Haskell,basicstyle=\small\ttfamily}}{}
$endif$
$if(highlighting-macros)$
$highlighting-macros$
$endif$
$if(verbatim-in-note)$
\usepackage{fancyvrb}
\VerbatimFootnotes % allows verbatim text in footnotes
$endif$
$if(tables)$
\usepackage{longtable,booktabs}
\usepackage{caption}
% These lines are needed to make table captions work with longtable:
\makeatletter
\def\fnum@table{\tablename~\thetable}
\makeatother
$endif$
$if(graphics)$
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight0.8\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
$endif$

$if(strikeout)$
\usepackage[normalem]{ulem}
% avoid problems with \sout in headers with hyperref:
\pdfstringdefDisableCommands{\renewcommand{\sout}{}}
$endif$
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
$if(numbersections)$
\setcounter{secnumdepth}{5}
$else$
\setcounter{secnumdepth}{0}
$endif$
$if(dir)$
\ifxetex
  % load bidi as late as possible as it modifies e.g. graphicx
  $if(latex-dir-rtl)$
  \usepackage[RTLdocument]{bidi}
  $else$
  \usepackage{bidi}
  $endif$
\fi
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \TeXXeTstate=1
  \newcommand{\RL}[1]{\beginR #1\endR}
  \newcommand{\LR}[1]{\beginL #1\endL}
  \newenvironment{RTL}{\beginR}{\endR}
  \newenvironment{LTR}{\beginL}{\endL}
\fi
$endif$

$if(title)$
\title{$title$}
$endif$
$if(subtitle)$
\subtitle{$subtitle$}
$endif$
$if(author)$
\author{$for(author)$$author$$sep$ \and $endfor$}
$endif$
\date{$date$}
$for(header-includes)$
$header-includes$
$endfor$


%%--------------------------
%%--------------------------
%% Stuff I added:
%%--------------------------
%%--------------------------

% Have slides with just the /section/subsection/subsubsection title:
\AtBeginPart{
  \let\insertpartnumber\relax
  \let\partname\relax
  \frame{\partpage}
}
\AtBeginSection{
  \let\insertsectionnumber\relax
  \let\sectionname\relax
  \frame{\sectionpage}
}
\AtBeginSubsection{
  \let\insertsubsectionnumber\relax
  \let\subsectionname\relax
  \frame{\subsectionpage}
}

\usepackage{float} % for tables

\usepackage{tikz} % needed for tables emphasis and colour background

% The next 4 commands create highlighting in yellow, green, pink, aqua
\newcommand*{\yellowemph}[1]{%
  \tikz[baseline=(X.base)] \node[rectangle, fill=yellow, rounded corners, inner sep=0.3mm] (X) {#1};%
}
\newcommand*{\greenemph}[1]{%
  \tikz[baseline=(X.base)] \node[rectangle, fill=green, rounded corners, inner sep=0.3mm] (X) {#1};%
}
\newcommand*{\pinkemph}[1]{%
  \tikz[baseline=(X.base)] \node[rectangle, fill=pink, rounded corners, inner sep=0.3mm] (X) {#1};%
}
\newcommand*{\aquaemph}[1]{%
  \tikz[baseline=(X.base)] \node[rectangle, fill=aqua, rounded corners, inner sep=0.3mm] (X) {#1};%
} % the colour "aqua" is defined below

% Various packages
\usepackage{etoolbox}
\usepackage{setspace}
\usepackage{fixltx2e}
\usepackage{url}
\usepackage{listings}
\usepackage{rotating}
\usepackage{array}
\usepackage{pgfpages}
\usepackage{booktabs}
\usepackage{graphicx}
\graphicspath{ {./figures/} }
\usepackage{hyperref}
\usepackage{caption}
\captionsetup{labelformat=empty}
\usepackage[normalem]{ulem}
\usepackage{wasysym}
\usepackage{amsmath}
\usepackage{tcolorbox}
\usepackage{dcolumn}
\usepackage{threeparttable}
\usepackage{tikz}

\usetikzlibrary{shapes,arrows,positioning}

% Define block
\tikzstyle{block} = [rectangle, draw, fill=blue!20, text width=1cm, text centered, rounded corners, minimum height=3em]
% Define another block
\tikzstyle{block2} = [rectangle, draw, fill=blue!20, text width=3cm, text centered, rounded corners, minimum height=2em]
% Define another block
\tikzstyle{block2r} = [rectangle, draw, fill=red!20, text width=3cm, text centered, rounded corners, minimum height=2em]
% Define another block
\tikzstyle{block2rw} = [rectangle, draw, fill=red!20, text width=7cm, text centered, rounded corners, minimum height=2em]
% Define yet another block
\tikzstyle{block3} = [rectangle, draw, fill=blue!20, text width=2cm, text centered, rounded corners, minimum height=3em]
% And another block
\tikzstyle{block4} = [rectangle, draw, text width=3cm, text centered, rounded corners, minimum height=3em]
% Define cloud
\tikzstyle{cloud} = [draw, ellipse, fill=red!20, node distance=1cm, minimum height=3em]
% Define another cloud
\tikzstyle{cloud2} = [draw, ellipse, node distance=1cm, minimum height=3em]
% Define another cloud
\tikzstyle{cloud3} = [draw, ellipse, fill=red!20, node distance=1cm, minimum height=2em]
% Define line
\tikzstyle{line} = [draw, -latex', node distance = 0.1cm, auto]



% Institute tags
$if(institute)$\institute{$institute$}$endif$

% New for dissertation defense: the vspace in title graphic. I wanted to add my committee members, so I needed to move the graphic up a bit
% Title Graphic
$if(titlegraphic)$\titlegraphic{\vspace{-1cm}\includegraphics[width=0.3\paperwidth]{$titlegraphic$}}$endif$

% Title page adjustments
\setbeamertemplate{title page}[empty]
\setbeamercolor{title page}{fg=,bg=white}

% The next 4 create the shadowy outline of the title on the title page
\usecolortheme{whale}
\usecolortheme{orchid}
\useinnertheme[shadow]{rounded}
\useoutertheme{infolines}

% Title adjustments
\setbeamercolor{title}{fg=pigmentblue,bg=newwhite}
\setbeamercolor{block title}{fg=pigmentblue,bg=white}
\setbeamerfont{subtitle}{size=\small}

% Colour adjustments
\definecolor{pigmentblue}{HTML}{333399}
\definecolor{newwhite}{HTML}{F8F8FF}
\definecolor{cadmiumred}{HTML}{E30022}
\definecolor{cyanprocess}{HTML}{00009C}
\definecolor{aqua}{HTML}{00FFFF}
\definecolor{darkmagenta}{HTML}{8B008B}
\setbeamercolor{frametitle}{fg=pigmentblue,bg=}
\setbeamercolor{structure}{fg=pigmentblue,bg=}
\setbeamercolor{local structure}{fg=pigmentblue}
\setbeamercolor{section in toc}{fg=pigmentblue,bg=white}
\setbeamercolor{footline}{fg=pigmentblue,bg=}
\setbeamercolor{itemize item}{fg=pigmentblue,bg=} % makes \item shape pigmentblue
\setbeamercolor{item}{fg=pigmentblue,bg=} % makes \subitem, \subsubitem etc. shapes pigmentblue
\hypersetup{colorlinks,linkcolor=,urlcolor=darkmagenta} % colors web links in dark magenta



%% Adjustments to beamer templates
%%--------------------------------

% Text margins
\setbeamersize{text margin left=0.5cm,text margin right=0.5cm}

% Create background that fades from cyanprocess to white and back to cyanprocess. 3 tikzpictures are necessary because you can't specify how long you want top, bottom and middle to be in the \shade command. The cm numbers come from trial and error. DO NOT delete that \makeatletter line. Crucial to make everything work.
\makeatletter
\setbeamertemplate{background canvas}{%
   \ifnumequal{\c@framenumber}{1}{%
      % First frame
      \color{white}\rule{\paperwidth}{\paperheight}
   }{% All other frames
\begin{tikzpicture}[remember picture,overlay]
\shade[top color=cyanprocess!15,bottom color=white]
  ([shift={(0cm,0cm)}]current page.north west)
     rectangle
  ([shift={(0cm,8.6cm)}]current page.south east);
\end{tikzpicture}     
\begin{tikzpicture}[remember picture,overlay]
\shade[top color=white,bottom color=white]
  ([shift={(0cm,-1.6cm)}]current page.north west)
     rectangle
  ([shift={(0cm,1.6cm)}]current page.south east);
\end{tikzpicture}     
\begin{tikzpicture}[remember picture,overlay]
\shade[top color=white,bottom color=cyanprocess!15]
  ([shift={(0cm,-8.6cm)}]current page.north west)
     rectangle
  ([shift={(0cm,0cm)}]current page.south east);
\end{tikzpicture}     
}}

% Remove slide navigation symbols
\setbeamertemplate{navigation symbols}{}

% Insert slides number (e.g. 2/20) on the bottom right and name, institution on the bottom left
% (also raises everything up a little)
\setbeamertemplate{footline}{\hspace{11.8cm}\vspace{0.15cm}\insertframenumber/\inserttotalframenumber}


% Remove all colours from headline
\setbeamertemplate{headline}{}

% Have frame title in the top center of each slide, 0.25 cm moved downwards
\makeatletter
\setbeamertemplate{frametitle}{
    \ifbeamercolorempty[bg]{frametitle}{}{\nointerlineskip}%
    \@tempdima=\textwidth%
    \advance\@tempdima by\beamer@leftmargin%
    \advance\@tempdima by\beamer@rightmargin%
    \vspace*{0.25cm} %%%%%%%%%%%%% Insert shift downwards
    \begin{beamercolorbox}[sep=0.3cm,center,wd=\the\@tempdima]{frametitle}
        \usebeamerfont{frametitle}%
        \vbox{}\vskip-1ex%
        \if@tempswa\else\csname beamer@ftecenter\endcsname\fi%
        \strut\insertframetitle\strut\par%
        {%
            \ifx\insertframesubtitle\@empty%
            \else%
            {\usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}\insertframesubtitle\strut\par}%
            \fi
        }%
        \vskip-1ex%
        \if@tempswa\else\vskip-.3cm\fi% set inside beamercolorbox... evil here...
    \end{beamercolorbox}%
}
\makeatother


% Have different shapes for item, subitem, subsubitem
\setbeamertemplate{itemize item}{$$\bullet$$}
\setbeamertemplate{itemize subsubitem}[circle]
\setbeamertemplate{itemize subitem}[triangle]


% Have item, subitem and subsubitem text all the same size
\setbeamertemplate{itemize/enumerate body begin}{\normalsize}
\setbeamertemplate{itemize/enumerate subbody begin}{\normalsize}
\setbeamertemplate{itemize/enumerate subsubbody begin}{\normalsize}


% Create command to display comments only I can see (using it in Pre(accent aigu)sentation.app)
\usepackage{pdfcomment}
\newcommand{\pdfnote}[1]{\marginnote{\pdfcomment[icon=note]{#1}}}

%%--------------------------
%%--------------------------
%% Actually begin document
%%--------------------------
%%--------------------------


\begin{document}
$if(title)$
\begin{frame}[plain]
  \titlepage
\end{frame}
$endif$



$for(include-before)$
$include-before$

$endfor$

$body$


$for(include-after)$
$include-after$

$endfor$


\end{document}