
R version 3.5.1 (2018-07-02) -- "Feather Spray"
Copyright (C) 2018 The R Foundation for Statistical Computing
Platform: x86_64-apple-darwin15.6.0 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> rm(list=ls())
> 
> library(blockTools)
> library(randomizr)
> library(plyr)
> library(ggplot2)
> 
> ## Save .csv files for blocked and randomized ##
> ## Sample is between 6 and 1000, with variations and sequences for different group sizes ##
> ## Following Ryan's suggestion, I set the seq() to bigger iterations, to keep the calulcation time, resulting file size and density down ##
> ## Repeats: 100 ##
> ## Levels: 5 ##
> ## Groups: 2 ##
> 
> sampled_numbers <- seq(from = 6, to = 1000, by = 8)
> length(sampled_numbers)
[1] 125
> repeats <- 100
> lev <- 5
> groups <- as.factor(c("control", "treatment"))
> 
> listoflists_1 <- rep(list(list()), length(lev)) # lists with with length(lev) # of lists (to store sampled numbers)
> 
> df_rand <- data.frame(matrix(NA, repeats, (length(groups)+2))) # needed for listofdf_rand (+2 to add variance and levels columns after the treatment group columns)
> colnames(df_rand) <- c(levels(groups), "variance", "levels")
> listofdf_rand <- rep(list(df_rand), length(sampled_numbers)) # list with length(sampled_numbers) # of df_rand (needed for listoflists_2)
> 
> listoflists_2 <- rep(list(listofdf_rand), length(lev)) # list with length(lev) # of listofdf_rand (to store means of randomized treatment groups)
> listoflists_3 <- rep(list(list()), length(sampled_numbers)) # list with length(sampled_numers) # of lists (to store blocking assignments)
> 
> df_blocked <- data.frame(matrix(NA, 1, (length(groups)+3))) # needed for listofdf_blocked (+3 to add columns later)
> colnames(df_blocked) <- c(levels(groups), "sampled_numbers", "repeat", "diff")
> listofdf_blocked <- rep(list(df_blocked), repeats) # list with repeats # of df_blocked (needed for listoflists_4)
> 
> listoflists_4 <- rep(list(listofdf_blocked), length(sampled_numbers)) #list with length(sampled_numbers) # of listofdf_blocked (to store means of blocked treatment groups)
> 
> pb <- txtProgressBar(min = 1, max = length(sampled_numbers), style = 3) # creates the percentage progress bar across the sampled numbers
> 
> for(q in 1:length(lev)){
+   for(x in 1:length(sampled_numbers)){
+     setTxtProgressBar(pb, x) # loads the percentage progress bar into the loop
+     set.seed(123)
+     listoflists_1[[q]][[x]] <- data.frame(replicate(repeats, sample(lev[q], sampled_numbers[x], replace = TRUE))) 
+     # randomly sample numbers
+     listoflists_1[[q]][[x]]$levels <- rep(lev[q], sampled_numbers[x]) 
+     # add column of levels
+     listoflists_1[[q]][[x]]$groups <- simple_ra(N = sampled_numbers[x], conditions=groups)  
+     # assign treatment for each amount of randomly sampled numbers and add as column
+     listoflists_1[[q]][[x]]$sampled_numbers <- rep(sampled_numbers[x], sampled_numbers[x]) 
+     # add column of of sampled numbers
+     listoflists_1[[q]][[x]]$repeats <- rep(repeats, sampled_numbers[x]) 
+     # add column of repeats
+     listoflists_1[[q]][[x]]$id <- 1:sampled_numbers[x]
+     # add column of continuous id (for blocking)
+       for(i in 1:repeats){
+         listoflists_3[[x]][[i]] <- assignment(block(listoflists_1[[q]][[x]], id.vars = "id", block.vars = names(listoflists_1[[q]][[x]])[i], n.tr = length(groups)), seed = 123)
+         # block and assign samples to treatment groups
+         for(z in 1:length(groups)){
+           listoflists_2[[q]][[x]][i,z] <- mean(listoflists_1[[q]][[x]][,i][listoflists_1[[q]][[x]]$groups == levels(groups)[z]])
+           # take means of each treatment group and add as column
+           listoflists_4[[x]][[i]][1,z] <- mean(listoflists_1[[q]][[x]][listoflists_1[[q]][[x]]$id %in% unname(listoflists_3[[x]][[i]]$assg[[1]][,z]), i]) # take means of each treatment group and add as column
+           # %in% is needed because $assg lists the assigned units, not their actual sampled values
+         }
+         listoflists_4[[x]][[i]][1,(length(groups)+1)] <- sampled_numbers[x]
+         # add column of sampled numbers
+         listoflists_4[[x]][[i]][1,(length(groups)+2)] <- repeats
+         # add column of repeats
+         listoflists_4[[x]][[i]][1,(length(groups)+3)] <- apply(listoflists_4[[x]][[i]][,1:length(groups)], 1, function(w) diff(range(w)))
+         # # calculate the max diff between treatment groups and add as column
+         listoflists_2[[q]][[x]][i,(length(groups)+1)] <- var(listoflists_1[[q]][[x]][,i]) 
+         # take variance of each repeat and add as column
+         listoflists_2[[q]][[x]][i,(length(groups)+2)] <- lev[q] 
+         # add column of levels
+       }  
+     listoflists_2[[q]][[x]]$groups <- rep(length(groups), repeats) 
+     # add groups to dataframes
+     listoflists_2[[q]][[x]]$sampled_numbers <- rep(sampled_numbers[x], repeats)
+     # add sampled numbers to dataframes
+     listoflists_2[[q]][[x]]$repeats <- rep(repeats, repeats)
+     # add repeats to dataframes
+     }
+ }
  |                                                                              |                                                                      |   0%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |===                                                                   |   4%  |                                                                              |===                                                                   |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  17%  |                                                                              |============                                                          |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  23%  |                                                                              |=================                                                     |  24%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |=====================                                                 |  31%  |                                                                              |======================                                                |  31%  |                                                                              |=======================                                               |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  40%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |==============================                                        |  44%  |                                                                              |===============================                                       |  44%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |=================================                                     |  48%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  56%  |                                                                              |========================================                              |  57%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  63%  |                                                                              |=============================================                         |  64%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |===============================================                       |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  77%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  80%  |                                                                              |========================================================              |  81%  |                                                                              |=========================================================             |  81%  |                                                                              |==========================================================            |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |===========================================================           |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |=================================================================     |  94%  |                                                                              |==================================================================    |  94%  |                                                                              |===================================================================   |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |====================================================================  |  98%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================| 100%> 
> list_all_samples <- unlist(listoflists_1, recursive=FALSE) 
> # turn listoflists_1 (which is a list of lists of dataframes) into a list of dataframes
> list_all_means_variances <- unlist(listoflists_2, recursive = FALSE) 
> # same for listoflists_2
> all_samples <- ldply(list_all_samples, data.frame) 
> # turn the list of dataframes of all samples into one giant dataframe of all samples
> all_means_variances <- ldply(list_all_means_variances, data.frame) 
> # same for list of dataframes of all means and variances
> all_means_variances$diff <- apply(all_means_variances[,1:length(groups)], 1, function(x) diff(range(x)))
> # calculate the max diff between treatment groups and add them as column "diff"
> all_means_variances$label <- c(rep("rand", nrow(all_means_variances)))
> # add the label "rand" to all rows (for plotting)
> 
> list_all_blocked <- unlist(listoflists_4, recursive = FALSE)
> # turn listoflists_4 (which is a list of lists of dataframes) into a list of dataframes
> all_blocked <- ldply(list_all_blocked, data.frame)
> # turn the list of dataframes with all blocked diffs into one giant dataframe of all diffs
> all_blocked$label <- c(rep("blocked", nrow(all_blocked)))
> # add the label "blocked" to all rows (for plotting)
> 
> write.csv(all_samples, file = "all_samples_2.csv")
> write.csv(all_means_variances, file = "all_means_variances_2.csv")
> write.csv(all_blocked, file = "all_blocked_2.csv")
> 
> rm(list=ls())
> 
> 
> 
> 
> ## Save .csv files for blocked and randomized ##
> ## Same as above, just for 3 groups ##
> 
> sampled_numbers <- seq(from = 9, to = 1002, by = 9)
> length(sampled_numbers)
[1] 111
> repeats <- 100
> lev <- 5
> groups <- as.factor(c("control", "treatment1", "treatment2"))
> 
> listoflists_1 <- rep(list(list()), length(lev)) # lists with with length(lev) # of lists (to store sampled numbers)
> 
> df_rand <- data.frame(matrix(NA, repeats, (length(groups)+2))) # needed for listofdf_rand (+2 to add variance and levels columns after the treatment group columns)
> colnames(df_rand) <- c(levels(groups), "variance", "levels")
> listofdf_rand <- rep(list(df_rand), length(sampled_numbers)) # list with length(sampled_numbers) # of df_rand (needed for listoflists_2)
> 
> listoflists_2 <- rep(list(listofdf_rand), length(lev)) # list with length(lev) # of listofdf_rand (to store means of randomized treatment groups)
> listoflists_3 <- rep(list(list()), length(sampled_numbers)) # list with length(sampled_numers) # of lists (to store blocking assignments)
> 
> df_blocked <- data.frame(matrix(NA, 1, (length(groups)+3))) # needed for listofdf_blocked (+3 to add columns later)
> colnames(df_blocked) <- c(levels(groups), "sampled_numbers", "repeat", "diff")
> listofdf_blocked <- rep(list(df_blocked), repeats) # list with repeats # of df_blocked (needed for listoflists_4)
> 
> listoflists_4 <- rep(list(listofdf_blocked), length(sampled_numbers)) #list with length(sampled_numbers) # of listofdf_blocked (to store means of blocked treatment groups)
> 
> pb <- txtProgressBar(min = 1, max = length(sampled_numbers), style = 3) # creates the percentage progress bar across the sampled numbers
> 
> for(q in 1:length(lev)){
+   for(x in 1:length(sampled_numbers)){
+     setTxtProgressBar(pb, x) # loads the percentage progress bar into the loop
+     set.seed(123)
+     listoflists_1[[q]][[x]] <- data.frame(replicate(repeats, sample(lev[q], sampled_numbers[x], replace = TRUE))) 
+     # randomly sample numbers
+     listoflists_1[[q]][[x]]$levels <- rep(lev[q], sampled_numbers[x]) 
+     # add column of levels
+     listoflists_1[[q]][[x]]$groups <- simple_ra(N = sampled_numbers[x], conditions=groups)  
+     # assign treatment for each amount of randomly sampled numbers and add as column
+     listoflists_1[[q]][[x]]$sampled_numbers <- rep(sampled_numbers[x], sampled_numbers[x]) 
+     # add column of of sampled numbers
+     listoflists_1[[q]][[x]]$repeats <- rep(repeats, sampled_numbers[x]) 
+     # add column of repeats
+     listoflists_1[[q]][[x]]$id <- 1:sampled_numbers[x]
+     # add column of continuous id (for blocking)
+       for(i in 1:repeats){
+         listoflists_3[[x]][[i]] <- assignment(block(listoflists_1[[q]][[x]], id.vars = "id", block.vars = names(listoflists_1[[q]][[x]])[i], n.tr = length(groups)), seed = 123)
+         # block and assign samples to treatment groups
+         for(z in 1:length(groups)){
+           listoflists_2[[q]][[x]][i,z] <- mean(listoflists_1[[q]][[x]][,i][listoflists_1[[q]][[x]]$groups == levels(groups)[z]])
+           # take means of each treatment group and add as column
+           listoflists_4[[x]][[i]][1,z] <- mean(listoflists_1[[q]][[x]][listoflists_1[[q]][[x]]$id %in% unname(listoflists_3[[x]][[i]]$assg[[1]][,z]), i]) # take means of each treatment group and add as column
+           # %in% is needed because $assg lists the assigned units, not their actual sampled values
+         }
+         listoflists_4[[x]][[i]][1,(length(groups)+1)] <- sampled_numbers[x]
+         # add column of sampled numbers
+         listoflists_4[[x]][[i]][1,(length(groups)+2)] <- repeats
+         # add column of repeats
+         listoflists_4[[x]][[i]][1,(length(groups)+3)] <- apply(listoflists_4[[x]][[i]][,1:length(groups)], 1, function(w) diff(range(w)))
+         # # calculate the max diff between treatment groups and add as column
+         listoflists_2[[q]][[x]][i,(length(groups)+1)] <- var(listoflists_1[[q]][[x]][,i]) 
+         # take variance of each repeat and add as column
+         listoflists_2[[q]][[x]][i,(length(groups)+2)] <- lev[q] 
+         # add column of levels
+       }  
+     listoflists_2[[q]][[x]]$groups <- rep(length(groups), repeats) 
+     # add groups to dataframes
+     listoflists_2[[q]][[x]]$sampled_numbers <- rep(sampled_numbers[x], repeats)
+     # add sampled numbers to dataframes
+     listoflists_2[[q]][[x]]$repeats <- rep(repeats, repeats)
+     # add repeats to dataframes
+     }
+ }
  |                                                                              |                                                                      |   0%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |===                                                                   |   4%  |                                                                              |===                                                                   |   5%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  17%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  23%  |                                                                              |=================                                                     |  24%  |                                                                              |=================                                                     |  25%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  40%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |===============================                                       |  44%  |                                                                              |===============================                                       |  45%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  57%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  63%  |                                                                              |=============================================                         |  64%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  77%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  80%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |===========================================================           |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================| 100%> 
> list_all_samples <- unlist(listoflists_1, recursive=FALSE) 
> # turn listoflists_1 (which is a list of lists of dataframes) into a list of dataframes
> list_all_means_variances <- unlist(listoflists_2, recursive = FALSE) 
> # same for listoflists_2
> all_samples <- ldply(list_all_samples, data.frame) 
> # turn the list of dataframes of all samples into one giant dataframe of all samples
> all_means_variances <- ldply(list_all_means_variances, data.frame) 
> # same for list of dataframes of all means and variances
> all_means_variances$diff <- apply(all_means_variances[,1:length(groups)], 1, function(x) diff(range(x)))
> # calculate the max diff between treatment groups and add them as column "diff"
> all_means_variances$label <- c(rep("rand", nrow(all_means_variances)))
> # add the label "rand" to all rows (for plotting)
> 
> list_all_blocked <- unlist(listoflists_4, recursive = FALSE)
> # turn listoflists_4 (which is a list of lists of dataframes) into a list of dataframes
> all_blocked <- ldply(list_all_blocked, data.frame)
> # turn the list of dataframes with all blocked diffs into one giant dataframe of all diffs
> all_blocked$label <- c(rep("blocked", nrow(all_blocked)))
> # add the label "blocked" to all rows (for plotting)
> 
> write.csv(all_samples, file = "all_samples_3.csv")
> write.csv(all_means_variances, file = "all_means_variances_3.csv")
> write.csv(all_blocked, file = "all_blocked_3.csv")
> 
> rm(list=ls())
> 
> 
> 
> ## Save .csv files for blocked and randomized ##
> ## Same as above, just for 5 groups
> 
> sampled_numbers <- seq(from = 15, to = 1000, by = 10)
> length(sampled_numbers)
[1] 99
> repeats <- 100
> lev <- 5
> groups <- as.factor(c("control", "treatment1", "treatment2", "treatment3", "treatment4"))
> 
> listoflists_1 <- rep(list(list()), length(lev)) # lists with with length(lev) # of lists (to store sampled numbers)
> 
> df_rand <- data.frame(matrix(NA, repeats, (length(groups)+2))) # needed for listofdf_rand (+2 to add variance and levels columns after the treatment group columns)
> colnames(df_rand) <- c(levels(groups), "variance", "levels")
> listofdf_rand <- rep(list(df_rand), length(sampled_numbers)) # list with length(sampled_numbers) # of df_rand (needed for listoflists_2)
> 
> listoflists_2 <- rep(list(listofdf_rand), length(lev)) # list with length(lev) # of listofdf_rand (to store means of randomized treatment groups)
> listoflists_3 <- rep(list(list()), length(sampled_numbers)) # list with length(sampled_numers) # of lists (to store blocking assignments)
> 
> df_blocked <- data.frame(matrix(NA, 1, (length(groups)+3))) # needed for listofdf_blocked (+3 to add columns later)
> colnames(df_blocked) <- c(levels(groups), "sampled_numbers", "repeat", "diff")
> listofdf_blocked <- rep(list(df_blocked), repeats) # list with repeats # of df_blocked (needed for listoflists_4)
> 
> listoflists_4 <- rep(list(listofdf_blocked), length(sampled_numbers)) #list with length(sampled_numbers) # of listofdf_blocked (to store means of blocked treatment groups)
> 
> pb <- txtProgressBar(min = 1, max = length(sampled_numbers), style = 3) # creates the percentage progress bar across the sampled numbers
> 
> for(q in 1:length(lev)){
+   for(x in 1:length(sampled_numbers)){
+     setTxtProgressBar(pb, x) # loads the percentage progress bar into the loop
+     set.seed(123)
+     listoflists_1[[q]][[x]] <- data.frame(replicate(repeats, sample(lev[q], sampled_numbers[x], replace = TRUE))) 
+     # randomly sample numbers
+     listoflists_1[[q]][[x]]$levels <- rep(lev[q], sampled_numbers[x]) 
+     # add column of levels
+     listoflists_1[[q]][[x]]$groups <- simple_ra(N = sampled_numbers[x], conditions=groups)  
+     # assign treatment for each amount of randomly sampled numbers and add as column
+     listoflists_1[[q]][[x]]$sampled_numbers <- rep(sampled_numbers[x], sampled_numbers[x]) 
+     # add column of of sampled numbers
+     listoflists_1[[q]][[x]]$repeats <- rep(repeats, sampled_numbers[x]) 
+     # add column of repeats
+     listoflists_1[[q]][[x]]$id <- 1:sampled_numbers[x]
+     # add column of continuous id (for blocking)
+       for(i in 1:repeats){
+         listoflists_3[[x]][[i]] <- assignment(block(listoflists_1[[q]][[x]], id.vars = "id", block.vars = names(listoflists_1[[q]][[x]])[i], n.tr = length(groups)), seed = 123)
+         # block and assign samples to treatment groups
+         for(z in 1:length(groups)){
+           listoflists_2[[q]][[x]][i,z] <- mean(listoflists_1[[q]][[x]][,i][listoflists_1[[q]][[x]]$groups == levels(groups)[z]])
+           # take means of each treatment group and add as column
+           listoflists_4[[x]][[i]][1,z] <- mean(listoflists_1[[q]][[x]][listoflists_1[[q]][[x]]$id %in% unname(listoflists_3[[x]][[i]]$assg[[1]][,z]), i]) # take means of each treatment group and add as column
+           # %in% is needed because $assg lists the assigned units, not their actual sampled values
+         }
+         listoflists_4[[x]][[i]][1,(length(groups)+1)] <- sampled_numbers[x]
+         # add column of sampled numbers
+         listoflists_4[[x]][[i]][1,(length(groups)+2)] <- repeats
+         # add column of repeats
+         listoflists_4[[x]][[i]][1,(length(groups)+3)] <- apply(listoflists_4[[x]][[i]][,1:length(groups)], 1, function(w) diff(range(w)))
+         # # calculate the max diff between treatment groups and add as column
+         listoflists_2[[q]][[x]][i,(length(groups)+1)] <- var(listoflists_1[[q]][[x]][,i]) 
+         # take variance of each repeat and add as column
+         listoflists_2[[q]][[x]][i,(length(groups)+2)] <- lev[q] 
+         # add column of levels
+       }  
+     listoflists_2[[q]][[x]]$groups <- rep(length(groups), repeats) 
+     # add groups to dataframes
+     listoflists_2[[q]][[x]]$sampled_numbers <- rep(sampled_numbers[x], repeats)
+     # add sampled numbers to dataframes
+     listoflists_2[[q]][[x]]$repeats <- rep(repeats, repeats)
+     # add repeats to dataframes
+     }
+ }
  |                                                                              |                                                                      |   0%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |===                                                                   |   4%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |========                                                              |  11%  |                                                                              |=========                                                             |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |==========                                                            |  14%  |                                                                              |===========                                                           |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  17%  |                                                                              |=============                                                         |  18%  |                                                                              |==============                                                        |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |===============                                                       |  21%  |                                                                              |================                                                      |  22%  |                                                                              |================                                                      |  23%  |                                                                              |=================                                                     |  24%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |===================                                                   |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |=====================                                                 |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |==========================                                            |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  40%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |===============================                                       |  44%  |                                                                              |===============================                                       |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |======================================                                |  54%  |                                                                              |=======================================                               |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  57%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |===========================================                           |  61%  |                                                                              |============================================                          |  62%  |                                                                              |============================================                          |  63%  |                                                                              |=============================================                         |  64%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |================================================                      |  68%  |                                                                              |=================================================                     |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |==================================================                    |  71%  |                                                                              |===================================================                   |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |====================================================                  |  74%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  77%  |                                                                              |======================================================                |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  80%  |                                                                              |========================================================              |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |===========================================================           |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |=============================================================         |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================| 100%> 
> list_all_samples <- unlist(listoflists_1, recursive=FALSE) 
> # turn listoflists_1 (which is a list of lists of dataframes) into a list of dataframes
> list_all_means_variances <- unlist(listoflists_2, recursive = FALSE) 
> # same for listoflists_2
> all_samples <- ldply(list_all_samples, data.frame) 
> # turn the list of dataframes of all samples into one giant dataframe of all samples
> all_means_variances <- ldply(list_all_means_variances, data.frame) 
> # same for list of dataframes of all means and variances
> all_means_variances$diff <- apply(all_means_variances[,1:length(groups)], 1, function(x) diff(range(x)))
> # calculate the max diff between treatment groups and add them as column "diff"
> all_means_variances$label <- c(rep("rand", nrow(all_means_variances)))
> # add the label "rand" to all rows (for plotting)
> 
> list_all_blocked <- unlist(listoflists_4, recursive = FALSE)
> # turn listoflists_4 (which is a list of lists of dataframes) into a list of dataframes
> all_blocked <- ldply(list_all_blocked, data.frame)
> # turn the list of dataframes with all blocked diffs into one giant dataframe of all diffs
> all_blocked$label <- c(rep("blocked", nrow(all_blocked)))
> # add the label "blocked" to all rows (for plotting)
> 
> write.csv(all_samples, file = "all_samples_5.csv")
> write.csv(all_means_variances, file = "all_means_variances_5.csv")
> write.csv(all_blocked, file = "all_blocked_5.csv")
> 
> rm(list=ls())
> 
> 
> 
> ## Save .csv files for blocked and randomized ##
> ## Same as above, just for 10 groups
> 
> sampled_numbers <- seq(from = 30, to = 1000, by = 10)
> length(sampled_numbers)
[1] 98
> repeats <- 100
> lev <- 5
> groups <- as.factor(c("control", "treatment1", "treatment2", "treatment3", "treatment4", "treatment5", "treatment6", "treatment7", "treatment8", "treatment9"))
> 
> listoflists_1 <- rep(list(list()), length(lev)) # lists with with length(lev) # of lists (to store sampled numbers)
> 
> df_rand <- data.frame(matrix(NA, repeats, (length(groups)+2))) # needed for listofdf_rand (+2 to add variance and levels columns after the treatment group columns)
> colnames(df_rand) <- c(levels(groups), "variance", "levels")
> listofdf_rand <- rep(list(df_rand), length(sampled_numbers)) # list with length(sampled_numbers) # of df_rand (needed for listoflists_2)
> 
> listoflists_2 <- rep(list(listofdf_rand), length(lev)) # list with length(lev) # of listofdf_rand (to store means of randomized treatment groups)
> listoflists_3 <- rep(list(list()), length(sampled_numbers)) # list with length(sampled_numers) # of lists (to store blocking assignments)
> 
> df_blocked <- data.frame(matrix(NA, 1, (length(groups)+3))) # needed for listofdf_blocked (+3 to add columns later)
> colnames(df_blocked) <- c(levels(groups), "sampled_numbers", "repeat", "diff")
> listofdf_blocked <- rep(list(df_blocked), repeats) # list with repeats # of df_blocked (needed for listoflists_4)
> 
> listoflists_4 <- rep(list(listofdf_blocked), length(sampled_numbers)) #list with length(sampled_numbers) # of listofdf_blocked (to store means of blocked treatment groups)
> 
> pb <- txtProgressBar(min = 1, max = length(sampled_numbers), style = 3) # creates the percentage progress bar across the sampled numbers
> 
> for(q in 1:length(lev)){
+   for(x in 1:length(sampled_numbers)){
+     setTxtProgressBar(pb, x) # loads the percentage progress bar into the loop
+     set.seed(123)
+     listoflists_1[[q]][[x]] <- data.frame(replicate(repeats, sample(lev[q], sampled_numbers[x], replace = TRUE))) 
+     # randomly sample numbers
+     listoflists_1[[q]][[x]]$levels <- rep(lev[q], sampled_numbers[x]) 
+     # add column of levels
+     listoflists_1[[q]][[x]]$groups <- simple_ra(N = sampled_numbers[x], conditions=groups)  
+     # assign treatment for each amount of randomly sampled numbers and add as column
+     listoflists_1[[q]][[x]]$sampled_numbers <- rep(sampled_numbers[x], sampled_numbers[x]) 
+     # add column of of sampled numbers
+     listoflists_1[[q]][[x]]$repeats <- rep(repeats, sampled_numbers[x]) 
+     # add column of repeats
+     listoflists_1[[q]][[x]]$id <- 1:sampled_numbers[x]
+     # add column of continuous id (for blocking)
+       for(i in 1:repeats){
+         listoflists_3[[x]][[i]] <- assignment(block(listoflists_1[[q]][[x]], id.vars = "id", block.vars = names(listoflists_1[[q]][[x]])[i], n.tr = length(groups)), seed = 123)
+         # block and assign samples to treatment groups
+         for(z in 1:length(groups)){
+           listoflists_2[[q]][[x]][i,z] <- mean(listoflists_1[[q]][[x]][,i][listoflists_1[[q]][[x]]$groups == levels(groups)[z]])
+           # take means of each treatment group and add as column
+           listoflists_4[[x]][[i]][1,z] <- mean(listoflists_1[[q]][[x]][listoflists_1[[q]][[x]]$id %in% unname(listoflists_3[[x]][[i]]$assg[[1]][,z]), i]) # take means of each treatment group and add as column
+           # %in% is needed because $assg lists the assigned units, not their actual sampled values
+         }
+         listoflists_4[[x]][[i]][1,(length(groups)+1)] <- sampled_numbers[x]
+         # add column of sampled numbers
+         listoflists_4[[x]][[i]][1,(length(groups)+2)] <- repeats
+         # add column of repeats
+         listoflists_4[[x]][[i]][1,(length(groups)+3)] <- apply(listoflists_4[[x]][[i]][,1:length(groups)], 1, function(w) diff(range(w)))
+         # # calculate the max diff between treatment groups and add as column
+         listoflists_2[[q]][[x]][i,(length(groups)+1)] <- var(listoflists_1[[q]][[x]][,i]) 
+         # take variance of each repeat and add as column
+         listoflists_2[[q]][[x]][i,(length(groups)+2)] <- lev[q] 
+         # add column of levels
+       }  
+     listoflists_2[[q]][[x]]$groups <- rep(length(groups), repeats) 
+     # add groups to dataframes
+     listoflists_2[[q]][[x]]$sampled_numbers <- rep(sampled_numbers[x], repeats)
+     # add sampled numbers to dataframes
+     listoflists_2[[q]][[x]]$repeats <- rep(repeats, repeats)
+     # add repeats to dataframes
+     }
+ }
  |                                                                              |                                                                      |   0%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |===                                                                   |   4%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |========                                                              |  11%  |                                                                              |=========                                                             |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |==========                                                            |  14%  |                                                                              |===========                                                           |  15%  |                                                                              |============                                                          |  16%  |                                                                              |============                                                          |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |==============                                                        |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  23%  |                                                                              |=================                                                     |  24%  |                                                                              |=================                                                     |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |===================                                                   |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |========================                                              |  34%  |                                                                              |=========================                                             |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  40%  |                                                                              |=============================                                         |  41%  |                                                                              |==============================                                        |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |===============================                                       |  44%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |==================================                                    |  48%  |                                                                              |===================================                                   |  49%  |                                                                              |===================================                                   |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  57%  |                                                                              |========================================                              |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  63%  |                                                                              |=============================================                         |  64%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |==================================================                    |  71%  |                                                                              |===================================================                   |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |====================================================                  |  74%  |                                                                              |=====================================================                 |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  77%  |                                                                              |=======================================================               |  78%  |                                                                              |========================================================              |  79%  |                                                                              |========================================================              |  80%  |                                                                              |=========================================================             |  81%  |                                                                              |==========================================================            |  82%  |                                                                              |==========================================================            |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |=============================================================         |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================| 100%> 
> list_all_samples <- unlist(listoflists_1, recursive=FALSE) 
> # turn listoflists_1 (which is a list of lists of dataframes) into a list of dataframes
> list_all_means_variances <- unlist(listoflists_2, recursive = FALSE) 
> # same for listoflists_2
> all_samples <- ldply(list_all_samples, data.frame) 
> # turn the list of dataframes of all samples into one giant dataframe of all samples
> all_means_variances <- ldply(list_all_means_variances, data.frame) 
> # same for list of dataframes of all means and variances
> all_means_variances$diff <- apply(all_means_variances[,1:length(groups)], 1, function(x) diff(range(x)))
> # calculate the max diff between treatment groups and add them as column "diff"
> all_means_variances$label <- c(rep("rand", nrow(all_means_variances)))
> # add the label "rand" to all rows (for plotting)
> 
> list_all_blocked <- unlist(listoflists_4, recursive = FALSE)
> # turn listoflists_4 (which is a list of lists of dataframes) into a list of dataframes
> all_blocked <- ldply(list_all_blocked, data.frame)
> # turn the list of dataframes with all blocked diffs into one giant dataframe of all diffs
> all_blocked$label <- c(rep("blocked", nrow(all_blocked)))
> # add the label "blocked" to all rows (for plotting)
> 
> write.csv(all_samples, file = "all_samples_10.csv")
> write.csv(all_means_variances, file = "all_means_variances_10.csv")
> write.csv(all_blocked, file = "all_blocked_10.csv")
> 
> rm(list=ls())
> 
> 
> proc.time()
     user    system   elapsed 
124774.76  33301.44 158088.59 
